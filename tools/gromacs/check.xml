<tool id="gmx_check" name="gmx check" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">
    <description>using check</description>
    <macros>
        <token name="@GALAXY_VERSION@">0</token>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
      #if $input_file.calculate_select == "info_traj":
          ln -s '$input_file.traj_file' ./input1.$input_file.traj_file.ext &&
          gmx check
              -f ./input1.$input_file.traj_file.ext
              &> '$output_file_traj'
      #elif $input_file.calculate_select == "compare_traj":
          ln -s '$input_file.traj_file' ./input1.$input_file.traj_file.ext &&
          ln -s '$input_file.traj_file2' ./input2.$input_file.traj_file2.ext &&
          gmx check
              -f ./input1.$input_file.traj_file.ext
              -f2 ./input2.$input_file.traj_file2.ext
              -rmsd '$input_file.rmsd'
              -abstol '$input_file.abs_tol'
              &> '$output_file_ctraj'
      #elif $input_file.calculate_select == "info_struc":
          ln -s '$input_file.struc_file' ./input1.$input_file.struc_file.ext &&
          gmx check
              -c ./input1.$input_file.struc_file.ext
              -vdwfac '$input_file.vdwfac'
              -bonlo '$input_file.bonlo'
              -bonhi '$input_file.bonhi'
              &> '$output_file_struc'
      #elif $input_file.calculate_select == "info_ener":
          ln -s '$input_file.ener_file' ./input1.$input_file.ener_file.ext &&
          gmx check
              -e ./input1.$input_file.ener_file.ext
              &> '$output_file_ener'
      #elif $input_file.calculate_select == "info_ind":
          ln -s '$input_file.ind_file' ./input1.$input_file.ind_file.ext &&
          gmx check
              -n ./input1.$input_file.ind_file.ext
              &> '$output_file_ind'
      #elif $input_file.calculate_select == "compare_ener":
          ln -s '$input_file.ener_file' ./input1.$input_file.ener_file.ext &&
          ln -s '$input_file.ener_file2' ./input2.$input_file.ener_file2.ext &&
          gmx check
              -e ./input1.$input_file.ener_file.ext
              -e2 ./input2.$input_file.ener_file2.ext
              -lastener '$input_file.lastener'
              -tol '$input_file.rel_tol'
              &> '$output_file_cener'
      #else:
          ln -s '$input_file.top_file' ./input1.$input_file.top_file.ext &&
          ln -s '$input_file.top_file2' ./input2.$input_file.top_file2.ext &&
          gmx check
              -s1 ./input1.$input_file.top_file.ext
              -s2 ./input2.$input_file.top_file2.ext
              -abstol '$input_file.abs_tol'
              &> '$output_file_top'
      #end if
    ]]></command>
    <inputs>
      <conditional name="input_file">
          <param name="calculate_select" type="select" label="What do you want to achieve?">
              <option value="info_traj">Information on a trajectory file</option>
              <option value="compare_traj">Compare two trajectory files</option>
              <option value="info_struc">Information on a structure file</option>
              <option value="info_ener">Information on a energy file</option>
              <option value="info_ind">Information on a index file</option>
              <option value="compare_top">Compare two topology files</option>
              <option value="compare_ener">Compare two energy files</option>
          </param>
          <when value="info_traj">
              <param name="traj_file" type="data" format="xtc, trr, cpt, gro, g96, pdb, tng" label="Trajectory file"/>
          </when>
          <when value="compare_traj">
              <param name="traj_file" type="data" format="xtc, trr, cpt, gro, g96, pdb, tng" label="Trajectory file 1"/>
              <param name="traj_file2" type="data" format="xtc, trr, cpt, gro, g96, pdb, tng" label="Trajectory file 2"/>
              <param name="rmsd" type="boolean" optional="True" label="Do you want to display the RMSD?"/>
              <param name="abs_tol" type="float" value="0.001" optional="True" label="Enter absolute tolerance"/>
          </when>
          <when value="info_struc">
              <param name="struc_file" type="data" format="tpr, gro, g96, pdb, brk, ent" label="Structure file"/>
              <param name="vdwfac" type="float" value="0.8" optional="True" label="Enter the fraction of sum of VdW radii"/>
              <param name="bonlo" type="float" value="0.4" optional="True" label="Enter the minimal fraction of sum of vdW radii for bonded atoms"/>
              <param name="bonhi" type="float" value="0.7" optional="True" label="Enter the maximal fraction of sum of vdW radii for bonded atoms"/>
          </when>
          <when value="info_ener">
              <param name="ener_file" type="data" format="edr" label="Energy file"/>
          </when>
          <when value="info_ind">
              <param name="ind_file" type="data" format="ndx" label="Index file"/>
          </when>
          <when value="compare_top">
              <param name="top_file" type="data" format="tpr" label="Topology file 1"/>
              <param name="top_file2" type="data" format="tpr" label="Topology file 2"/>
              <param name="abs_tol" type="float" value="0.001" optional="True" label="Enter absolute tolerance"/>
          </when>
          <when value="compare_ener">
              <param name="ener_file" type="data" format="edr" label="Energy file 1"/>
              <param name="ener_file2" type="data" format="edr" label="Energy file 2"/>
              <param name="rel_tol" type="float" value="0.001" optional="True" label="Enter relative tolerance"/>
              <param name="lastener" type="text" value="all" optional="True" label="Enter the last energy term to compare"/>
          </when>
      </conditional>
    </inputs>
    <outputs>
        <data name="output_file_traj" format="txt" label="infos trajectory">
            <filter>input_file['calculate_select'] == 'info_traj'</filter>
        </data>
        <data name="output_file_ctraj" format="txt" label="compare trajectory">
            <filter>input_file['calculate_select'] == 'compare_traj'</filter>
        </data>
        <data name="output_file_struc" format="txt" label="infos structure">
            <filter>input_file['calculate_select'] == 'info_struc'</filter>
        </data>
        <data name="output_file_ener" format="txt" label="infos energy">
            <filter>input_file['calculate_select'] == 'info_ener'</filter>
        </data>
        <data name="output_file_ind" format="txt" label="infos index">
            <filter>input_file['calculate_select'] == 'info_ind'</filter>
        </data>
        <data name="output_file_top" format="txt" label="compare topology">
            <filter>input_file['calculate_select'] == 'compare_top'</filter>
        </data>
        <data name="output_file_cener" format="txt" label="compare energy">
            <filter>input_file['calculate_select'] == "compare_ener"</filter>
        </data>
    </outputs>
    <tests>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_traj"/>
              <param name="traj_file" value="nvt.xtc" ftype="xtc"/>
          </conditional>
          <output name="output_file_traj" file="check_traj.txt" ftype="txt" lines_diff="41"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_traj"/>
              <param name="traj_file" value="nvt.xtc" ftype="xtc"/>
              <param name="traj_file2" value="npt.xtc" ftype="xtc"/>
          </conditional>
          <output name="output_file_ctraj" file="check_compare_f.txt" ftype="txt" lines_diff="45"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_traj"/>
              <param name="traj_file" value="nvt.xtc" ftype="xtc"/>
              <param name="traj_file2" value="npt.xtc" ftype="xtc"/>
              <param name="rmsd" value="True"/>
          </conditional>
          <output name="output_file_ctraj" file="check_comp_f_rmsd.txt" ftype="txt" lines_diff="20"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_traj"/>
              <param name="traj_file" value="nvt.xtc" ftype="xtc"/>
              <param name="traj_file2" value="npt.xtc" ftype="xtc"/>
              <param name="abs_tol" value="0.1"/>
          </conditional>
          <output name="output_file_ctraj" file="check_comp_f_abstol.txt" ftype="txt" lines_diff="18"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_traj"/>
              <param name="traj_file" value="nvt.xtc" ftype="xtc"/>
              <param name="traj_file2" value="npt.xtc" ftype="xtc"/>
              <param name="rmsd" value="True"/>
              <param name="abs_tol" value="0.1"/>
          </conditional>
          <output name="output_file_ctraj" file="check_comp_f_abstol_rmsd.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
          </conditional>
          <output name="output_file_struc" file="check_struc.txt" ftype="txt" lines_diff="55"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="vdwfac" value="0.5"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_vdw.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="bonlo" value="0.2"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_lo.txt" ftype="txt" lines_diff="20"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="bonhi" value="0.8"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_hi.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="bonlo" value="0.2"/>
              <param name="bonhi" value="0.8"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_lo_hi.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="vdwfac" value="0.5"/>
              <param name="bonlo" value="0.2"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_vdw_lo.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="vdwfac" value="0.5"/>
              <param name="bonhi" value="0.8"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_vdw_hi.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_struc"/>
              <param name="struc_file" value="minim.gro" ftype="gro"/>
              <param name="vdwfac" value="0.5"/>
              <param name="bonlo" value="0.2"/>
              <param name="bonhi" value="0.8"/>
          </conditional>
          <output name="output_file_struc" file="check_struc_vdw_lo_hi.txt" ftype="txt" lines_diff="14"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_ener"/>
              <param name="ener_file" value="minim.edr" ftype="edr"/>
          </conditional>
          <output name="output_file_ener" file="check_ener.txt" ftype="txt" lines_diff="45"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="info_ind"/>
              <param name="ind_file" value="index.ndx" ftype="ndx"/>
          </conditional>
          <output name="output_file_ind" file="check_ind.txt" ftype="txt" lines_diff="41"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_ener"/>
              <param name="ener_file" value="minim.edr" ftype="edr"/>
              <param name="ener_file2" value="outp.edr" ftype="edr"/>
          </conditional>
          <output name="output_file_cener" file="check_compare_e.txt" ftype="txt" lines_diff="38"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_ener"/>
              <param name="ener_file" value="minim.edr" ftype="edr"/>
              <param name="ener_file2" value="outp.edr" ftype="edr"/>
              <param name="rel_tol" value="0.1"/>
          </conditional>
          <output name="output_file_cener" file="check_comp_e_tol.txt" ftype="txt" lines_diff="38"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_ener"/>
              <param name="ener_file" value="minim.edr" ftype="edr"/>
              <param name="ener_file2" value="outp.edr" ftype="edr"/>
              <param name="lastener" value="Pressure"/>
          </conditional>
          <output name="output_file_cener" file="check_comp_e_last.txt" ftype="txt" lines_diff="34"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_ener"/>
              <param name="ener_file" value="minim.edr" ftype="edr"/>
              <param name="ener_file2" value="outp.edr" ftype="edr"/>
              <param name="rel_tol" value="0.1"/>
              <param name="lastener" value="Pressure"/>
          </conditional>
          <output name="output_file_cener" file="check_comp_e_tol_last.txt" ftype="txt" lines_diff="28"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_top"/>
              <param name="top_file" value="nvt.tpr" ftype="tpr"/>
              <param name="top_file2" value="npt.tpr" ftype="tpr"/>
          </conditional>
          <output name="output_file_top" file="check_compare_t.txt" ftype="txt" lines_diff="115"/>
        </test>
        <test>
          <conditional name="input_file">
              <param name="calculate_select" value="compare_top"/>
              <param name="top_file" value="nvt.tpr" ftype="tpr"/>
              <param name="top_file2" value="npt.tpr" ftype="tpr"/>
              <param name="abs_tol" value="0.1"/>
          </conditional>
          <output name="output_file_top" file="check_compare_t_abstol.txt" ftype="txt" lines_diff="16"/>
        </test>
    </tests>
    <help><![CDATA[
        Hello world!
    ]]></help>
    <expand macro="citations" />
</tool>
